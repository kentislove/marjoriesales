<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ Marjorie å€‰åº«å‡ºæ¸…</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-font: 'Noto Serif TC', serif;
            --secondary-font: 'Noto Sans TC', sans-serif;
            --text-color: #333;
            --subtle-text-color: #777;
            --background-color: #f8f8f8;
            --card-background: #fff;
            --border-color: #e0e0e0;
            --accent-color: #000;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --promo-color: #E84A5F; /* ä¿ƒéŠ·äº®è‰² */
            --page-padding-x: 20px; /* å®šç¾© PC é è¨­çš„å·¦å³ padding */
        }

        body {
            font-family: var(--secondary-font);
            margin: 0;
            /* PC é è¨­å…§é‚Šè· */
            padding: 30px var(--page-padding-x); 
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        /* é é¢æ¨™é¡Œèˆ‡è³¼ç‰©è»Šåœ–ç¤ºå®¹å™¨ (å·²å°‡ #cart-icon ç§»å‡ºæ­¤å®¹å™¨ï¼Œæ­¤è™•ä¿ç•™ä¸è®Š) */
        #header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto 20px;
        }

        h1 {
            font-family: var(--primary-font);
            color: #1a1a1a;
            font-size: 2.5rem;
            margin: 0;
            text-align: center;
            width: 100%;
        }
        
        /* ä¿ƒéŠ·å£è™Ÿ PC é è¨­æ¨£å¼ (åŒ…å«å‹•ç•«) */
        #slogan-container {
            max-width: 1200px;
            margin: 10px auto 30px;
            text-align: center;
            background-color: var(--promo-color);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            animation: pulse 1.5s infinite alternate; 
        }

        #slogan-container p {
            margin: 5px 0;
            font-weight: 500;
            font-size: 1.1rem;
        }

        #slogan-container strong {
            font-size: 1.4rem;
            display: block;
            margin: 5px 0;
            font-family: var(--primary-font);
        }
        
        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
            to { transform: scale(1.01); box-shadow: 0 8px 15px rgba(0,0,0,0.3); }
        }

        /* è³¼ç‰©è»Šåœ–ç¤ºæ¨£å¼ ã€é‡è¦ä¿®æ­£ï¼šæ”¹ç‚ºæµ®å‹•å®šä½ã€‘ */
        #cart-icon {
            /* å¾ static è®Šæ›´ç‚º fixedï¼Œä½¿å…¶æ‡¸æµ®æ–¼è¦–çª— */
            position: fixed; 
            top: 20px; /* è·é›¢é ‚éƒ¨ 20px */
            right: 20px; /* è·é›¢å³å´ 20px */
            z-index: 1001; /* ç¢ºä¿å®ƒåœ¨æ‰€æœ‰å…¶ä»–å…ƒç´ ï¼ˆåŒ…æ‹¬ Modal, Lightbox é™¤å¤–ï¼‰ä¹‹ä¸Š */
            cursor: pointer;
            padding: 10px;
            transition: color 0.3s;
            background-color: rgba(255, 255, 255, 0.8); /* å¢åŠ ä¸€å€‹åŠé€æ˜èƒŒæ™¯ï¼Œä½¿å…¶åœ¨è¤‡é›œèƒŒæ™¯ä¸Šæ›´é¡¯çœ¼ */
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #cart-icon:hover {
            color: var(--error-color); /* æ‡¸æµ®æ™‚æ›å€‹æ›´æ˜é¡¯çš„é¡è‰² */
        }
        /* åŸå§‹çš„ #header-container è£¡çš„ #cart-icon å®šä½å·²ç¶“ç§»é™¤ï¼Œæ‰€ä»¥é€™æ˜¯å”¯ä¸€çš„å®šä½ */

        #cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--error-color);
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            line-height: 1;
        }

        /* ä¸»å…§å®¹å®¹å™¨ (ä¸è®Š) */
        #main-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ç”¢å“åˆ—è¡¨èˆ‡ç¯©é¸æ¨£å¼ (PC é è¨­) */
        #search-container {
            text-align: center;
            margin-bottom: 20px;
        }

        #search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-sizing: border-box;
            background-color: var(--card-background);
            color: var(--text-color);
        }

        #filters {
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px;
            overflow-x: visible; 
            padding-bottom: 0;
        }
        
        /* ============== RWD åª’é«”æŸ¥è©¢ä¿®æ­£å€åŸŸ (é—œéµä¿®å¾©) ============== */
        @media (max-width: 768px) {
            /* ã€RWD ä¿®æ­£ 1ã€‘å°‡ body çš„å·¦å³ padding è¨­ç‚º 0ï¼Œåªä¿ç•™å‚ç›´ padding */
            body {
                padding: 15px 0; 
            }
            
            /* å°‡ #main-content/h1/header-container å…§å®¹é›†ä¸­åŒ…åœ¨ä¸€å€‹æœ‰ padding çš„å€å¡Šå…§ */
            #header-container, #main-content > div:not(#product-list), #search-container {
                padding-left: 15px;
                padding-right: 15px;
            }

            /* ä¿®æ­£ Header çµæ§‹ */
            #header-container {
                flex-direction: row; /* ä¿æŒæ°´å¹³æ’åˆ—ï¼Œä½†è®“ h1 å„ªå…ˆä½”ä½ */
                align-items: center;
                margin-bottom: 10px;
            }
            h1 {
                font-size: 2rem;
                margin-bottom: 0;
                text-align: left; /* è®“æ¨™é¡Œé å·¦ */
                flex-grow: 1;
                /* ç§»é™¤ padding-right: 10pxï¼Œå› ç‚º #cart-icon å·²ç¶“æµ®å‹•ï¼Œä¸ä½”æ“šç©ºé–“ */
            }
            /* ç”±æ–¼ #cart-icon å·²æµ®å‹•ï¼Œæ­¤è™•ä¸å†éœ€è¦ flex-shrink: 0 */
            
            /* ã€RWD ä¿®æ­£ï¼šèª¿æ•´æµ®å‹•æŒ‰éˆ•åœ¨æ‰‹æ©Ÿä¸Šçš„ä½ç½®ã€‘ */
            #cart-icon {
                top: 10px; /* æ‰‹æ©Ÿä¸Šé›¢é ‚éƒ¨æ›´è¿‘ */
                right: 10px; /* æ‰‹æ©Ÿä¸Šé›¢å³å´æ›´è¿‘ */
                padding: 5px; /* æ‰‹æ©Ÿä¸Šç¸®å° padding */
            }

            /* ã€RWD ä¿®æ­£ 2ã€‘ä¿ƒéŠ·æ–‡æ¡ˆï¼Œè®“å…¶å¾¹åº•ä½”æ»¿è¢å¹•å¯¬åº¦ */
            #slogan-container {
                /* ç§»é™¤ margin: auto çš„å½±éŸ¿ï¼Œè®“å…¶ä½”æ“šå…¨éƒ¨å¯¬åº¦ */
                max-width: 100%;
                width: 100%; 
                margin: 10px 0 20px 0; /* ç§»é™¤å·¦å³ marginï¼Œé ‚åˆ°åº• */
                border-radius: 0; 
                padding: 12px 15px; /* å…§é‚Šè·ä¾ç„¶å­˜åœ¨ */
                animation: none; 
            }

            #slogan-container p {
                font-size: 0.85rem; 
                line-height: 1.3;
            }

            #slogan-container strong {
                font-size: 1.1rem; 
                margin: 3px 0;
            }
            
            /* ã€RWD ä¿®æ­£ 3ã€‘ç¯©é¸å™¨ RWD - æ©«å‘æ»¾å‹• */
            #filters {
                justify-content: flex-start;
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 5px 0 15px 0; 
                /* è®“å®ƒèƒ½å¤ æ»¿å¯¬é¡¯ç¤º */
                width: 100vw; 
                transform: translateX(calc(-50vw + 50%)); /* å±…ä¸­ä¸¦æ»¿å¯¬çš„ CSS Hack */
                margin-bottom: 20px;
                margin-left: 0; 
                margin-right: 0;
                /* é‡æ–°æ·»åŠ å·¦å³ padding åˆ° #filters å…§éƒ¨ï¼Œç¢ºä¿å…§å®¹ä¸è²¼é‚Š */
                padding-left: 15px; 
                padding-right: 15px; 
            }
            
            /* éš±è—æ»¾å‹•æ¢ */
            #filters::-webkit-scrollbar {
                display: none;
            }
            #filters {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            
            #product-list {
                grid-template-columns: 1fr;
                padding-left: 15px; /* ç”¢å“åˆ—è¡¨ä¹Ÿéœ€è¦å·¦å³ padding */
                padding-right: 15px;
            }
            
            /* RWD ç‡ˆç®±é—œé–‰æŒ‰éˆ•èª¿æ•´ */
            .lightbox-overlay .close-btn {
                top: auto;
                bottom: 20px;
                right: 20px;
            }
        }
        /* ============================================== */
        
        .filter-tag {
            flex-shrink: 0;
            background-color: #fff;
            color: var(--subtle-text-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, color 0.3s;
            font-size: 14px;
        }
        
        .filter-tag:hover {
            background-color: var(--border-color);
        }
        
        .filter-tag.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        #product-list {
            display: grid;
            gap: 40px;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        /* ç”¢å“å¡ç‰‡è¦æ ¼é¸æ“‡å™¨æ¨£å¼ (æ–°å¢) */
        .product-card {
            background-color: var(--card-background);
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.3s ease;
            /* cursor: pointer; */ /* ç§»é™¤ï¼Œå› ç‚ºæœ‰äº’å‹•å…ƒç´  */
        }

        .product-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .product-images {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            cursor: pointer;
        }

        .product-images img {
            width: 100%;
            height: auto;
            object-fit: contain;
            transition: transform 0.5s ease;
        }

        .product-info {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .product-info h2 {
            font-family: var(--primary-font);
            margin-top: 0;
            color: #1a1a1a;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .product-info p {
            margin: 5px 0;
            line-height: 1.6;
        }
        
        .product-info .price {
            font-size: 1.2rem;
            color: var(--error-color);
            font-weight: 500;
            margin-bottom: 10px;
        }

        .spec-selector {
            margin: 15px 0;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .spec-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .spec-selector select, .spec-selector input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-sizing: border-box;
        }

        .spec-selector button {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .spec-selector button:hover {
            background-color: #333;
        }

        .stock-info {
            font-size: 14px;
            color: var(--subtle-text-color);
            margin-top: -5px;
            margin-bottom: 10px;
            min-height: 1.6em; /* é˜²æ­¢å…§å®¹é–ƒçˆ */
        }
        
        .out-of-stock {
            color: var(--error-color);
            font-weight: 500;
        }

        /* å½ˆå‡ºè¦–çª— Lightbox & Modal æ¨£å¼ (æ–°å¢/ä¿®æ”¹) */
        .modal-overlay, .lightbox-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow-y: auto; /* å…è¨±å‚ç›´æ»¾å‹• */
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            align-items: flex-start; /* è®“æ¨¡æ…‹æ¡†é è¿‘é ‚éƒ¨ */
            padding-top: 5vh;
            z-index: 1002; /* ç¢ºä¿è³¼ç‰©è»Šå½ˆçª—åœ¨æµ®å‹•åœ–ç¤ºä¹‹ä¸Š */
        }

        .modal-content {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 5px;
            width: 90%;
            max-width: 700px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é—œé–‰æŒ‰éˆ•åŸºåº•æ¨£å¼ (çµ¦è³¼ç‰©è»Šå½ˆçª—ä½¿ç”¨) */
        .close-btn {
            position: absolute;
            /* é è¨­ç‚ºè³¼ç‰©è»Šå½ˆçª—çš„æ¨£å¼ */
            top: 10px;
            right: 20px;
            color: var(--text-color); 
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        /* Lightbox é—œé–‰æŒ‰éˆ•æ¨£å¼ ã€é‡è¦ä¿®æ­£ï¼šæ”¹ç‚ºå³ä¸‹è§’å®šä½ã€‘ */
        .lightbox-overlay .close-btn {
            top: auto; /* å–æ¶ˆåŸæœ¬çš„ top: 10px; å½±éŸ¿ */
            right: 20px; /* ä¿æŒå³å´è·é›¢ */
            bottom: 20px; /* è·é›¢åº•éƒ¨ 20px */
            color: #fff; /* Lightbox é—œé–‰éˆ•æ”¹ç‚ºç™½è‰² */
            font-size: 40px; /* æ”¾å¤§ä¸€é»ï¼Œæ›´å¥½é»æ“Š */
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        
        .close-btn:hover {
            color: #ccc;
        }
        
        /* Lightbox åœ–ç‰‡è‡ªé©æ‡‰ä¿®æ­£ */
        /* ã€ä¿®æ­£ 4ã€‘ç¢ºä¿ Lightbox å®¹å™¨ä½”æ“šæ•´å€‹è¦–çª—ï¼Œä¸¦ç¢ºä¿åœ–ç‰‡èƒ½å¤ æœ€å¤§åŒ–é¡¯ç¤º */
        .lightbox-container {
            position: relative;
            /* è®“å®¹å™¨ä½”æ“šè¦–çª— 90% çš„ç©ºé–“ */
            width: 90%;
            max-width: 900px;
            height: 90%; /* å¢åŠ é«˜åº¦ï¼Œæä¾›æ›´å¤šç©ºé–“ */
            max-height: 900px; 
            margin: auto;
        }

        .lightbox-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-content img {
            /* åœ–ç‰‡æœ€å¤§åŒ–ä½”æ“šå¯ç”¨ç©ºé–“ */
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* ç¢ºä¿åœ–ç‰‡ä¸è¢«è£åˆ‡ï¼Œå®Œæ•´é¡¯ç¤º */
            display: none;
        }

        .lightbox-content img.active {
            display: block;
        }
        
        .prev-btn, .next-btn {
            color: #fff; /* æŒ‰éˆ•é¡è‰²æ”¹ç‚ºç™½è‰² */
            font-size: 40px; /* ç¨å¾®ç¸®å°æŒ‰éˆ• */
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .prev-btn:hover, .next-btn:hover {
            opacity: 1;
        }
        /* End Lightbox åœ–ç‰‡è‡ªé©æ‡‰ä¿®æ­£ */

        /* è³¼ç‰©è»Šåˆ—è¡¨æ¨£å¼ */
        #cart-items-list {
            margin-top: 20px;
            list-style: none;
            padding: 0;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .cart-item-info {
            flex-grow: 1;
        }
        
        .cart-item-info h4 {
            margin: 0 0 5px 0;
            font-family: var(--primary-font);
            font-size: 1.2rem;
        }
        
        .cart-item-info p {
            margin: 0;
            font-size: 14px;
            color: var(--subtle-text-color);
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            padding: 5px;
            border: 1px solid var(--border-color);
            border-radius: 3px;
            box-sizing: border-box; /* æ–°å¢æ­¤è¡Œç¢ºä¿é‚Šæ¡†ä¸å½±éŸ¿å¯¬åº¦ */
        }
        
        .remove-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }
        
        #cart-total {
            text-align: right;
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
        }

        #checkout-button {
            width: 100%;
            padding: 15px;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        #checkout-button:hover {
            background-color: #45a049;
        }
        
        /* çµå¸³èªªæ˜é é¢æ¨£å¼ */
        #checkout-page {
            display: none; /* é è¨­éš±è— */
            padding: 40px 20px;
            background-color: var(--card-background);
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 50vh;
        }

        #checkout-page h2 {
            font-family: var(--primary-font);
            font-size: 2rem;
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 30px;
        }

        #checkout-page ol {
            max-width: 600px;
            margin: 0 auto;
            padding-left: 20px;
            line-height: 2;
        }
        
        #checkout-page ol li {
            margin-bottom: 15px;
        }
        
        #checkout-page strong {
            color: var(--error-color);
        }

        .line-contact-box {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .line-contact-box img {
            max-width: 150px;
            height: auto;
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .line-contact-box p {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .shipping-alert {
            display: block;
            padding: 10px;
            margin-top: 15px;
            background-color: #fff3cd; /* è­¦ç¤ºé»ƒè‰²èƒŒæ™¯ */
            color: #856404; /* æ·±é»ƒè‰²æ–‡å­— */
            border: 1px solid #ffeeba;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.95rem;
            text-align: center;
        }

        .bank-info-box {
            background-color: #f0f8ff; /* æ·ºè—è‰²èƒŒæ™¯ */
            border: 1px solid #c2e0ff;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
            margin-top: 10px;
        }

        .bank-info-box ul {
            list-style: none;
            padding: 0;
            margin: 5px 0 0 0;
        }
        
        .bank-info-box li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .bank-info-box code {
            background-color: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .back-to-cart-btn {
            display: block;
            width: 200px;
            margin: 30px auto 0;
            padding: 12px;
            text-align: center;
            background-color: var(--subtle-text-color);
            color: white;
            border-radius: 3px;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-to-cart-btn:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div id="header-container">
        <h1>Marjorie å€‰åº«æœ€çµ‚æ¸…å€‰æ´»å‹•</h1>
        </div>
    
    <div id="cart-icon">
        <i class="fas fa-shopping-cart fa-2x"></i>
        <span id="cart-count">0</span>
    </div>
    
    <div id="slogan-container">

<p>ğŸ“¦ å‡ºè²¨æé†’ï¼šå› äººæ‰‹ä¸è¶³ï¼Œè¨‚å–®éœ€ 7 å€‹å·¥ä½œå¤©å‚™è²¨ã€‚ </p>
        <strong>æ»¿åƒå³äº«å…é‹ï¼Œå”®å®Œä¸è£œï¼ </strong>
        <p>âš ï¸ æ¡åŒ¯æ¬¾é †åºå‡ºè²¨ï¼Œè«‹æŠŠæ¡æœ€å¾Œæ©Ÿæœƒã€‚</p>
    </div>
    
    <div id="main-content">
        <div id="product-page">
            <div id="search-container">
                <input type="text" id="search-box" placeholder="è¼¸å…¥ç”¢å“åç¨±æœå°‹...">
            </div>
            <div id="filters"></div>
            <div id="product-list">è¼‰å…¥ä¸­...</div>
        </div>
        
        <div id="checkout-page">
            <h2>ğŸ‰ è¨‚å–®ç¢ºèªèˆ‡ä»˜æ¬¾èªªæ˜</h2>
            <p style="text-align: center; font-size: 1.1rem; margin-bottom: 40px;">è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿå®Œæˆæ‚¨çš„è¨‚å–®ï¼Œæˆ‘å€‘æœƒåœ¨æ”¶åˆ°æ¬¾é …å¾Œç›¡å¿«ç‚ºæ‚¨å‡ºè²¨ã€‚</p>
            
            <div id="order-summary-checkout" style="max-width: 600px; margin: 0 auto 30px; background-color: #f0f0f0; padding: 20px; border-radius: 5px; font-size: 1.1rem;">
                <p><strong>æ‚¨é¸æ“‡çš„æ–¹æ¡ˆ:</strong> <span id="checkout-shipping-option"></span></p>
                <p><strong>è¨‚å–®å°è¨ˆ:</strong> NT$ <span id="checkout-subtotal"></span></p>
                <p><strong>é‹è²»:</strong> NT$ <span id="checkout-shipping"></span></p>
                <p style="font-size: 1.5rem; color: var(--error-color); margin-top: 10px;"><strong>ç¸½ä»˜æ¬¾é‡‘é¡:</strong> NT$ <span id="checkout-total"></span></p>
            </div>
            
            <ol>
                <li>
                    <strong>è¯ç¹«å®¢æœæä¾›æ”¶ä»¶è³‡è¨Š:</strong> 
                    <div class="line-contact-box">
                        <img src="https://qr-official.line.me/gs/M_318latbk_GW.png?oat_content=qr" alt="LINE QR Code">
                        <p>è«‹æƒæ QR Code **æˆ–** åŠ å…¥ LINE ID: **@318latbk** ç•™è¨€ã€‚</p>
                        
                        <span id="checkout-shipping-alert" class="shipping-alert">
                            </span>
                        
                        <p style="margin-top: 20px;">è«‹å‹™å¿…æä¾›ä»¥ä¸‹å®Œæ•´è³‡è¨Šï¼š</p>
                        <ul style="list-style-type: none; padding: 0; text-align: left; max-width: 300px; margin: 10px auto;">
                            <li>âœ… **è¨‚å–®æ˜ç´°æˆªåœ–** (åŒ…å«ç¸½é‡‘é¡èˆ‡é‹é€æ–¹å¼)</li>
                            <li>âœ… **æ”¶ä»¶äººå§“å**</li>
                            <li>âœ… **è¯çµ¡é›»è©±**</li>
                            <li id="checkout-address-needed"></li>
                            <li id="checkout-store-needed"></li>
                        </ul>
                    </div>
                </li>
                <li>
                    <strong>é€²è¡Œä»˜æ¬¾:</strong> 
                    <div id="checkout-payment-details">
                         </div>
                </li>
                <li><strong>ç­‰å¾…ç¢ºèª:</strong> æˆ‘å€‘æœƒåœ¨æ”¶åˆ°æ‚¨çš„è³‡æ–™èˆ‡æ¬¾é …å¾Œï¼Œç™¼å‡ºè¨‚å–®ç¢ºèªé€šçŸ¥ï¼Œä¸¦å„˜é€Ÿå®‰æ’å‡ºè²¨ã€‚</li>
            </ol>
            <p style="text-align: center; margin-top: 40px;">æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼è‹¥æœ‰ä»»ä½•ç–‘å•ï¼Œæ­¡è¿éš¨æ™‚è¯ç¹«å®¢æœã€‚</p>
            <button class="back-to-cart-btn" onclick="showCartModal(event)">è¿”å›è³¼ç‰©è»Š</button>
        </div>
        </div>
    
    <div class="modal-overlay" id="cart-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeCartModal()">&times;</span>
            <h2>æˆ‘çš„è³¼ç‰©è»Š</h2>
            <ul id="cart-items-list">
                </ul>

            <div id="shipping-selector" style="margin: 15px 0; padding: 15px 0; border-top: 1px dashed var(--border-color);">
                <h3 style="margin-top: 0; font-size: 1.3rem;">é¸æ“‡é…é€èˆ‡ä»˜æ¬¾æ–¹å¼</h3>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                    <label>
                        <input type="radio" name="shipping-option" value="transfer_store" checked>
                        åŒ¯æ¬¾ (ç‹é“éŠ€è¡Œ) + å…¨å®¶åº—åˆ°åº— (<span style="color: var(--promo-color);">æ»¿ NT$1000 å…é‹</span>)
                    </label>
                    <label>
                        <input type="radio" name="shipping-option" value="cod_store">
                        è¶…å•†å–è²¨ä»˜æ¬¾ + å…¨å®¶åº—åˆ°åº— (<span style="color: var(--promo-color);">æ»¿ NT$2000 å…é‹</span>)
                    </label>
                    <label>
                        <input type="radio" name="shipping-option" value="home_delivery">
                        å®…é…åˆ°åºœ (<span style="color: var(--error-color);">é‹è²»ä¸€å¾‹ NT$145</span>)
                    </label>
                </div>
            </div>
            <div id="cart-summary">
                <div id="cart-subtotal" style="text-align: right; font-size: 1.1rem; font-weight: normal; padding-bottom: 5px;">å°è¨ˆ (æœªå«é‹): NT$ <span id="subtotal-amount">0</span></div>
                <div id="cart-shipping-fee" style="text-align: right; font-size: 1.1rem; font-weight: normal; padding-bottom: 5px;">é‹è²»: NT$ <span id="shipping-amount">0</span></div>

                <div id="cart-total">ç¸½è¨ˆ: NT$ <span id="total-amount">0</span></div>
                <button id="checkout-button">ç¢ºå®šè³¼è²·ï¼Œå‰å¾€çµå¸³</button>
            </div>
        </div>
    </div>

    <div class="lightbox-overlay" id="lightbox">
        <span class="close-btn">&times;</span>
        <span class="prev-btn">&#10094;</span>
        <div class="lightbox-container" id="lightbox-container">
            <div class="lightbox-content" id="lightbox-content">
            </div>
        </div>
        <span class="next-btn">&#10095;</span>
    </div>

    <script>
        const apiUrl = 'https://script.google.com/macros/s/AKfycbyKANC6RockaftLdI114N5_OPkqlTZFcU9x5UHFsX7O0nneICwAW4-G0kR0zgu9Gh0iwA/exec';
        const CART_STORAGE_KEY = 'shoppingCart';
        
        // DOM å…ƒç´ 
        const productListDiv = document.getElementById('product-list');
        const filtersDiv = document.getElementById('filters');
        const searchBox = document.getElementById('search-box');
        const cartIcon = document.getElementById('cart-icon');
        const cartCount = document.getElementById('cart-count');
        const cartModal = document.getElementById('cart-modal');
        const cartItemsList = document.getElementById('cart-items-list');
        const checkoutButton = document.getElementById('checkout-button');
        const productPage = document.getElementById('product-page');
        const checkoutPage = document.getElementById('checkout-page');
        const lightbox = document.getElementById('lightbox');
        const lightboxContent = document.getElementById('lightbox-content');
        const closeBtn = lightbox.querySelector('.close-btn');
        const prevBtn = document.querySelector('.prev-btn');
        const nextBtn = document.querySelector('.next-btn');

        // ã€R: æ–°å¢/ä¿®æ”¹ DOM å…ƒç´ èˆ‡å¸¸æ•¸ - STARTã€‘
        const shippingSelector = document.getElementById('shipping-selector');
        const subtotalAmountSpan = document.getElementById('subtotal-amount');
        const shippingAmountSpan = document.getElementById('shipping-amount');
        const totalAmountSpan = document.getElementById('total-amount'); // é€™æ˜¯æœ€çµ‚ç¸½è¨ˆ

        const SHIPPING_COST_DEFAULT = 60; // åº—åˆ°åº—çš„é è¨­é‹è²» (è‹¥æœªé”å…é‹é–€æª»)
        const SHIPPING_COST_HOME = 145; // å®…é…é‹è²»ä¸€å¾‹ $145

        // ç‹€æ…‹è®Šæ•¸
        let currentImageIndex = 0;
        let lightboxImages = [];
        let allProductsData = {};
        let activeCategory = 'all';
        let cart = loadCartFromStorage(); // å¾æœ¬åœ°å„²å­˜è¼‰å…¥è³¼ç‰©è»Š
        let selectedShippingOption = 'transfer_store'; // ã€R: æ–°å¢ã€‘é è¨­é¸é …ï¼šåŒ¯æ¬¾ + åº—åˆ°åº—
        // ã€R: æ–°å¢/ä¿®æ”¹ DOM å…ƒç´ èˆ‡å¸¸æ•¸ - ENDã€‘

        // --- è³¼ç‰©è»Šèˆ‡é é¢ç®¡ç†é‚è¼¯ ---

        /**
         * å¾ localStorage è¼‰å…¥è³¼ç‰©è»Šè³‡æ–™ã€‚
         * @returns {Array} è³¼ç‰©è»Šé™£åˆ—ã€‚
         */
        function loadCartFromStorage() {
            try {
                const storedCart = localStorage.getItem(CART_STORAGE_KEY);
                return storedCart ? JSON.parse(storedCart) : [];
            } catch (e) {
                console.error("ç„¡æ³•å¾ localStorage è¼‰å…¥è³¼ç‰©è»Š:", e);
                return [];
            }
        }

        /**
         * å°‡è³¼ç‰©è»Šè³‡æ–™å„²å­˜åˆ° localStorageã€‚
         */
        function saveCartToStorage() {
            try {
                localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
            } catch (e) {
                console.error("ç„¡æ³•å°‡è³¼ç‰©è»Šå„²å­˜åˆ° localStorage:", e);
            }
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'block' : 'none';
        }

        // ã€R: é‡æ–°å‘½å/ä¿®æ”¹ã€‘åªè¨ˆç®—å•†å“ç¸½åƒ¹ (Subtotal)
        function calculateCartSubtotal() {
            return cart.reduce((total, item) => {
                // ç¢ºä¿åƒ¹æ ¼æ˜¯æœ‰æ•ˆçš„æ•¸å­—ï¼Œç§»é™¤éæ•¸å­—å­—ç¬¦ (å¦‚ NT$)
                const priceMatch = item.price.match(/[\d,.]+/);
                const price = priceMatch ? parseFloat(priceMatch[0].replace(/,/g, '')) : 0;
                return total + (price * item.quantity);
            }, 0);
        }

        // ã€R: æ–°å¢ã€‘è¨ˆç®—é‹è²»
        function calculateShippingFee(subtotal, option) {
            if (option === 'home_delivery') {
                return SHIPPING_COST_HOME; // å®…é…ä¸€å¾‹ 145
            } else if (option === 'transfer_store') {
                // åŒ¯æ¬¾ + åº—åˆ°åº—: æ»¿ NT$1000 å…é‹
                return subtotal >= 1000 ? 0 : SHIPPING_COST_DEFAULT; 
            } else if (option === 'cod_store') {
                // è²¨åˆ°ä»˜æ¬¾ + åº—åˆ°åº—: æ»¿ NT$2000 å…é‹
                return subtotal >= 2000 ? 0 : SHIPPING_COST_DEFAULT; 
            }
            return 0; // é è¨­å€¼
        }

        function renderCart() {
            cartItemsList.innerHTML = '';
            
            const subtotal = calculateCartSubtotal();
            
            if (cart.length === 0) {
                cartItemsList.innerHTML = '<p style="text-align: center; color: var(--subtle-text-color);">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼å¿«å»æŒ‘é¸å–œæ­¡çš„ç”¢å“å§ã€‚</p>';
                subtotalAmountSpan.textContent = '0';
                shippingAmountSpan.textContent = '0';
                totalAmountSpan.textContent = '0';
                checkoutButton.disabled = true;
                shippingSelector.style.display = 'none'; // è³¼ç‰©è»Šç‚ºç©ºæ™‚éš±è—é¸æ“‡å™¨
                return;
            }
            
            shippingSelector.style.display = 'block'; // è³¼ç‰©è»Šæœ‰æ±è¥¿æ™‚é¡¯ç¤ºé¸æ“‡å™¨
            
            // 1. æ¸²æŸ“ç”¢å“é …ç›®
            cart.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'cart-item';
                
                // è¨ˆç®—å–®é …å°è¨ˆ
                const priceMatch = item.price.match(/[\d,.]+/);
                const price = priceMatch ? parseFloat(priceMatch[0].replace(/,/g, '')) : 0;
                const subtotalItem = (price * item.quantity).toLocaleString('en-US');

                li.innerHTML = `
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <p>è¦æ ¼: ${item.size} / ${item.color}</p>
                        <p>å–®åƒ¹: ${item.price}</p>
                    </div>
                    <div class="cart-item-actions">
                        <span class="price-display">å°è¨ˆ: NT$ ${subtotalItem}</span>
                        <button class="remove-btn" data-index="${index}"><i class="fas fa-trash-alt"></i> ç§»é™¤</button>
                    </div>
                `;
                
                cartItemsList.appendChild(li);
            });
            
            // 2. è¨ˆç®—é‹è²»èˆ‡ç¸½è¨ˆ
            const shippingFee = calculateShippingFee(subtotal, selectedShippingOption);
            const finalTotal = subtotal + shippingFee;

            // 3. æ›´æ–°ç¸½é¡é¡¯ç¤º
            subtotalAmountSpan.textContent = subtotal.toLocaleString('en-US');
            shippingAmountSpan.textContent = shippingFee.toLocaleString('en-US');
            totalAmountSpan.textContent = finalTotal.toLocaleString('en-US');
            
            checkoutButton.disabled = false;
            
            // 4. ç¶å®šç§»é™¤æŒ‰éˆ•äº‹ä»¶
            cartItemsList.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    cart.splice(index, 1);
                    renderCart(); // ç§»é™¤å¾Œé‡æ–°æ¸²æŸ“
                    updateCartCount();
                    saveCartToStorage(); 
                });
            });

            // 5. ç¢ºä¿é¸ä¸­çš„ Radio Button ç‹€æ…‹æ­£ç¢º
            const selectedRadio = shippingSelector.querySelector(`input[value="${selectedShippingOption}"]`);
            if (selectedRadio) {
                selectedRadio.checked = true;
            }
        }

        function addToCart(productName, selectedSize, selectedColor, quantity, price) {
            const existingItemIndex = cart.findIndex(item => 
                item.name === productName && 
                item.size === selectedSize && 
                item.color === selectedColor
            );

            if (existingItemIndex > -1) {
                // å¦‚æœç”¢å“å·²å­˜åœ¨ï¼Œæ›´æ–°æ•¸é‡
                cart[existingItemIndex].quantity += quantity;
            } else {
                // å¦å‰‡æ–°å¢ç”¢å“
                cart.push({
                    name: productName,
                    size: selectedSize,
                    color: selectedColor,
                    quantity: quantity,
                    price: price
                });
            }

            updateCartCount();
            saveCartToStorage(); // åŠ å…¥å¾Œå„²å­˜
            alert(`${productName} (${selectedSize}/${selectedColor}) x ${quantity} å·²åŠ å…¥è³¼ç‰©è»Šï¼`);
        }

        function showCartModal(event) {
             event.stopPropagation(); // é˜²æ­¢é»æ“Šåœ–ç¤ºæ™‚è§¸ç™¼å…¶ä»–äº‹ä»¶
             // åªæœ‰åœ¨ç”¢å“åˆ—è¡¨é é¢é»æ“Šè³¼ç‰©è»Šåœ–ç¤ºæ™‚æ‰è™•ç†
             if(productPage.style.display !== 'none') {
                cartModal.style.display = 'flex';
                renderCart(); // é¡¯ç¤ºæ™‚ç¢ºä¿å…§å®¹æ˜¯æœ€æ–°çš„
             }
        }
        
        function closeCartModal() {
            cartModal.style.display = 'none';
        }
        
        // ã€R: ä¿®æ”¹ã€‘å‹•æ…‹ç”Ÿæˆçµå¸³é é¢å…§å®¹
        function showCheckoutPage() {
            productPage.style.display = 'none';
            checkoutPage.style.display = 'block';
            cartModal.style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' }); // æ»¾å‹•åˆ°é é¢é ‚éƒ¨
            
            // ============ çµå¸³é é¢å‹•æ…‹å…§å®¹ç”Ÿæˆ ============
            const subtotal = calculateCartSubtotal();
            const shippingFee = calculateShippingFee(subtotal, selectedShippingOption);
            const finalTotal = subtotal + shippingFee;
            
            // 1. è¨‚å–®ç¸½çµ
            document.getElementById('checkout-subtotal').textContent = subtotal.toLocaleString('en-US');
            document.getElementById('checkout-shipping').textContent = shippingFee.toLocaleString('en-US');
            document.getElementById('checkout-total').textContent = finalTotal.toLocaleString('en-US');
            
            let shippingOptionText = '';
            let alertHtml = '';
            let paymentDetailsHtml = '';
            let addressNeededHtml = '';
            let storeNeededHtml = '';
            
            const bankTransferHtml = `
                <div class="bank-info-box">
                    <p>è«‹å°‡ç¸½é‡‘é¡åŒ¯æ¬¾è‡³ä»¥ä¸‹æŒ‡å®šå¸³æˆ¶ï¼š</p>
                    <ul>
                        <li>**éŠ€è¡Œåç¨±:** **ç‹é“éŠ€è¡Œ** (éŠ€è¡Œä»£ç¢¼: <code>048</code>)</li>
                        <li>**éŠ€è¡Œå¸³è™Ÿ:** <code>01000191591188</code></li>
                    </ul>
                </div>
                <p style="margin-top: 10px; font-size: 0.9em; color: var(--error-color);">**é‡è¦æé†’:** åŒ¯æ¬¾å®Œæˆå¾Œï¼Œè«‹å‹™å¿…é€é LINE æä¾›**å¸³è™Ÿå¾Œäº”ç¢¼**æˆ–**åŒ¯æ¬¾è­‰æ˜æˆªåœ–**çµ¦æˆ‘å€‘ä»¥ä¾›æ ¸å°ã€‚</p>
            `;
            
            const codHtml = `
                <div class="bank-info-box" style="background-color: #f7fff0; border-color: #d8ffd8; color: #387038;">
                    <p><strong>æ‚¨é¸æ“‡è²¨åˆ°ä»˜æ¬¾ï¼Œç„¡éœ€é å…ˆåŒ¯æ¬¾ã€‚</strong></p>
                    <p>è«‹ç­‰å¾…å®¢æœæä¾›**å–è²¨ä¸‹å–®é€£çµ**ï¼Œæ‚¨å°‡åœ¨è¶…å•†å–è²¨æ™‚æ”¯ä»˜æ‰€æœ‰æ¬¾é …ã€‚</p>
                </div>
            `;

            switch (selectedShippingOption) {
                case 'transfer_store':
                    shippingOptionText = `åŒ¯æ¬¾ + å…¨å®¶åº—åˆ°åº— (æ»¿ NT$1000 å…é‹)`;
                    alertHtml = `
                        ğŸšš **è¶…å•†å–è²¨ - åŒ¯æ¬¾å¾Œå‡ºè²¨**
                        <br>
                        è«‹æä¾›**å…¨å®¶é–€å¸‚åç¨±/åº—è™Ÿ**ä»¥ä¾›å¯„ä»¶ã€‚
                        ${shippingFee === 0 ? '<br><span style="color:var(--success-color);">ğŸ‰ æœ¬æ¬¡äº«å…é‹å„ªæƒ ï¼</span>' : `<br>æœ¬æ¬¡é‹è²» NT$${SHIPPING_COST_DEFAULT}ã€‚`}
                    `;
                    storeNeededHtml = '<li>âœ… **å…¨å®¶é–€å¸‚åç¨±/åº—è™Ÿ**</li>';
                    paymentDetailsHtml = bankTransferHtml;
                    break;
                    
                case 'cod_store':
                    shippingOptionText = `è¶…å•†å–è²¨ä»˜æ¬¾ + å…¨å®¶åº—åˆ°åº— (æ»¿ NT$2000 å…é‹)`;
                    alertHtml = `
                        ğŸšš **é‡è¦æé†’ï¼šè¶…å•†å–è²¨ä»˜æ¬¾**
                        <br>
                        è¶…å•†å–è²¨ä»˜æ¬¾æœå‹™é ˆç­‰
                        <br>
                        **å°ç·¨æä¾›é€£çµå¾Œé»æ“Šä¸‹å–®**æ‰æ”¯æ´å–è²¨ä»˜æ¬¾å–”ï¼
                        ${shippingFee === 0 ? '<br><span style="color:var(--success-color);">ğŸ‰ æœ¬æ¬¡äº«å…é‹å„ªæƒ ï¼</span>' : `<br>æœ¬æ¬¡é‹è²» NT$${SHIPPING_COST_DEFAULT}ã€‚`}
                    `;
                    storeNeededHtml = '<li>âœ… **å…¨å®¶é–€å¸‚åç¨±/åº—è™Ÿ**</li>';
                    paymentDetailsHtml = codHtml;
                    break;

                case 'home_delivery':
                    shippingOptionText = `å®…é…åˆ°åºœ (é‹è²»ä¸€å¾‹ NT$${SHIPPING_COST_HOME})`;
                    // ç‚ºäº†ç°¡åŒ–æµç¨‹ï¼Œå‡è¨­å®…é…é»˜èªä½¿ç”¨åŒ¯æ¬¾æ”¯ä»˜ï¼Œå¦å‰‡éœ€è¦æ›´å¤šé¸é …ä¾†å€åˆ†ä»˜æ¬¾æ–¹å¼
                    alertHtml = `
                        ğŸšš **é‡è¦æé†’ï¼šå®…é…åˆ°åºœ (åŒ¯æ¬¾å¾Œå‡ºè²¨)**
                        <br>
                        é‹è²»ä¸€å¾‹ ${SHIPPING_COST_HOME} å…ƒã€‚è«‹æä¾›æ‚¨çš„**å®Œæ•´æ”¶ä»¶åœ°å€**ã€‚
                    `;
                    addressNeededHtml = '<li>âœ… **å®Œæ•´æ”¶ä»¶åœ°å€** (å¿…å¡«)</li>';
                    paymentDetailsHtml = bankTransferHtml; 
                    break;
                    
                default:
                    shippingOptionText = 'æœªé¸æ“‡é…é€æ–¹å¼';
                    paymentDetailsHtml = '<p style="color: var(--error-color);">è«‹è¿”å›è³¼ç‰©è»Šé¸æ“‡é…é€æ–¹å¼ï¼</p>';
                    break;
            }
            
            document.getElementById('checkout-shipping-option').textContent = shippingOptionText;
            document.getElementById('checkout-shipping-alert').innerHTML = alertHtml;
            document.getElementById('checkout-payment-details').innerHTML = paymentDetailsHtml;
            
            // æ›´æ–°æ”¶ä»¶è³‡è¨Šåˆ—è¡¨
            document.getElementById('checkout-address-needed').innerHTML = addressNeededHtml;
            document.getElementById('checkout-store-needed').innerHTML = storeNeededHtml;
        }
        // ã€R: ä¿®æ”¹ showCheckoutPage å‡½å¼ - ENDã€‘

        function showProductList() {
             productPage.style.display = 'block';
             checkoutPage.style.display = 'none';
        }
        
        // é é¢ç‹€æ…‹åˆ‡æ›äº‹ä»¶
        cartIcon.addEventListener('click', showCartModal);
        checkoutButton.addEventListener('click', showCheckoutPage);
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                closeCartModal();
            }
        });

        // ã€R: æ–°å¢ã€‘é…é€é¸é …è®Šæ›´äº‹ä»¶
        shippingSelector.addEventListener('change', (e) => {
            if (e.target.name === 'shipping-option') {
                selectedShippingOption = e.target.value;
                renderCart(); // é‹é€æ–¹å¼è®Šæ›´æ™‚ï¼Œé‡æ–°è¨ˆç®—é‹è²»å’Œç¸½åƒ¹
            }
        });
        
        // ã€æ–°å¢å·¥å…·å‡½å¼ã€‘: æ¸…ç†ç”¢å“åç¨±ä»¥ç”Ÿæˆå®‰å…¨çš„ ID
        function getSafeId(productName) {
            // æ›¿æ›æ‰€æœ‰éå­—æ¯æ•¸å­—ã€éä¸­æ–‡ã€éæ¸›è™Ÿã€éåº•ç·šçš„å­—ç¬¦ç‚ºé€£å­—ç¬¦ '-'
            // é€™åŒ…æ‹¬äº†ç©ºæ ¼ã€é€—è™Ÿã€é»è™Ÿã€ç‰¹æ®Šç¬¦è™Ÿç­‰
            return productName
                .replace(/[^a-zA-Z0-9\u4e00-\u9fa5_-]/g, '-')
                .replace(/--+/g, '-') // å°‡å¤šå€‹é€£å­—ç¬¦æ›¿æ›ç‚ºå–®å€‹
                .toLowerCase();
        }

        // --- ç”¢å“æ¸²æŸ“èˆ‡ç¯©é¸é‚è¼¯ (ä¿®æ”¹è™•ç†é‚è¼¯) ---
        
        function getAvailableSpecs(productName) {
            const product = allProductsData[productName];
            const details = product ? product.details : {};
            const specs = {
                sizes: new Set(),
                colors: new Set(),
                detailsMap: {} // å„²å­˜ (å°ºå¯¸-é¡è‰²) -> æ•¸é‡ çš„æ˜ å°„
            };
            
            for (const key in details) {
                const detail = details[key];
                // ç¢ºä¿å°ºå¯¸å’Œé¡è‰²ä¸æ˜¯ null æˆ– undefined
                const size = String(detail['å°ºå¯¸'] || 'ç„¡');
                const color = String(detail['é¡è‰²'] || 'ç„¡');
                
                specs.sizes.add(size);
                specs.colors.add(color);
                specs.detailsMap[`${size}-${color}`] = detail['æ•¸é‡'];
            }
            
            // ç¢ºä¿ 'ç„¡' è¦æ ¼æ°¸é åœ¨åˆ—è¡¨æœ€å‰é¢
            const sortedSizes = [...specs.sizes].sort((a, b) => {
                // ã€é—œéµä¿®æ­£ã€‘å¼·åˆ¶è½‰æ›ç‚ºå­—ä¸²ï¼Œé¿å…éå­—ä¸²é¡å‹èª¿ç”¨ localeCompare
                const strA = String(a);
                const strB = String(b);
                
                if (strA === 'ç„¡') return -1;
                if (strB === 'ç„¡') return 1;
                return strA.localeCompare(strB);
            });
            const sortedColors = [...specs.colors].sort((a, b) => {
                // ã€é—œéµä¿®æ­£ã€‘å¼·åˆ¶è½‰æ›ç‚ºå­—ä¸²ï¼Œé¿å…éå­—ä¸²é¡å‹èª¿ç”¨ localeCompare
                const strA = String(a);
                const strB = String(b);
                
                if (strA === 'ç„¡') return -1;
                if (strB === 'ç„¡') return 1;
                return strA.localeCompare(strB);
            });
            
            return {
                sizes: sortedSizes, // Array
                colors: sortedColors, // Array
                detailsMap: specs.detailsMap
            };
        }
        
        function renderProducts(productsToRender) {
            productListDiv.innerHTML = '';
            showProductList(); 

            if (Object.keys(productsToRender).length === 0) {
                productListDiv.innerHTML = '<p style="text-align: center; width: 100%;">æ²’æœ‰æ‰¾åˆ°ç›¸é—œç”¢å“ã€‚</p>';
                return;
            }

            for (const productName in productsToRender) {
                const productData = productsToRender[productName];
                const safeProductId = getSafeId(productName); // ã€é—œéµä¿®æ­£ã€‘å–å¾—å®‰å…¨ ID
                const specs = getAvailableSpecs(productName);
                const firstPrice = productData.productInfo['å”®åƒ¹'] || 'NT$ åƒ¹æ ¼å¾…å®š';
                
                // åˆ¤æ–·æ˜¯å¦ç‚ºå¤šè¦æ ¼ï¼šå°ºå¯¸æˆ–é¡è‰²é›†åˆä¸­ä»»ä¸€å€‹æ•¸é‡å¤§æ–¼ 1ï¼Œæˆ–åƒ…æœ‰ 'ç„¡' ä»¥å¤–çš„å–®ä¸€è¦æ ¼
                const hasMultipleSpecs = (specs.sizes.length > 1 && !(specs.sizes.length === 2 && specs.sizes.includes('ç„¡'))) ||Â 
                                         (specs.colors.length > 1 && !(specs.colors.length === 2 && specs.colors.includes('ç„¡')));
                
                // å¦‚æœæ˜¯å–®ä¸€è¦æ ¼ï¼Œéœ€è¦ç¢ºå®šè¦æ ¼åç¨±
                const singleSize = specs.sizes[0] || 'ç„¡';
                const singleColor = specs.colors[0] || 'ç„¡';
                
                const card = document.createElement('div');
                card.className = 'product-card';

                const photos = productData.productInfo['ç…§ç‰‡é€£çµ'] ? productData.productInfo['ç…§ç‰‡é€£çµ'].split(',').map(url => url.trim()).filter(url => url !== '') : [];
                let imagesHtml = '';
                if (photos.length > 0) {
                    // ä½¿ç”¨ encodeURIComponent ç¢ºä¿ JSON æ ¼å¼åœ¨ HTML å±¬æ€§ä¸­å®‰å…¨
                    const photosJson = JSON.stringify(photos).replace(/"/g, '&quot;'); 
                    imagesHtml = `<div class="product-images">
                        <img src="${photos[0]}" alt="${productName}" data-photos='${photosJson}'>
                    </div>`;
                }
                
                // è¦æ ¼é¸æ“‡å™¨
                let specSelectorHtml = '';
                if (hasMultipleSpecs) {
                    specSelectorHtml = `
                        <div class="spec-selector">
                            <label for="size-${safeProductId}">å°ºå¯¸:</label>
                            <select id="size-${safeProductId}" data-spec-type="size">
                                ${specs.sizes.map(s => `<option value="${s}">${s}</option>`).join('')}
                            </select>
                            
                            <label for="color-${safeProductId}">é¡è‰²:</label>
                            <select id="color-${safeProductId}" data-spec-type="color">
                                ${specs.colors.map(c => `<option value="${c}">${c}</option>`).join('')}
                            </select>
                            
                            <div class="stock-info" id="stock-info-${safeProductId}">è«‹é¸æ“‡è¦æ ¼</div>
                            
                            <label for="qty-${safeProductId}">æ•¸é‡:</label>
                            <input type="number" id="qty-${safeProductId}" value="1" min="1" max="1" disabled>
                            
                            <button class="add-to-cart-btn" data-product-name="${productName}" data-price="${firstPrice}" disabled>åŠ å…¥è³¼ç‰©è»Š</button>
                        </div>
                    `;
                } else {
                    // å–®ä¸€æˆ–ç„¡è¦æ ¼ç”¢å“
                    const stock = specs.detailsMap[`${singleSize}-${singleColor}`] || 0;
                    const stockText = stock > 0 ? `åº«å­˜: ${stock}` : `<span class="out-of-stock">ç¼ºè²¨</span>`;
                    specSelectorHtml = `
                        <div class="spec-selector">
                            ${(singleSize !== 'ç„¡' || singleColor !== 'ç„¡') ? `<p>è¦æ ¼: ${singleSize}/${singleColor}</p>` : ''}
                            <p class="stock-info" id="stock-info-${safeProductId}">${stockText}</p>
                            <label for="qty-${safeProductId}">æ•¸é‡:</label>
                            <input type="number" id="qty-${safeProductId}" value="1" min="1" max="${stock}" ${stock === 0 ? 'disabled' : ''}>
                            <button class="add-to-cart-btn" data-product-name="${productName}" data-price="${firstPrice}" data-size="${singleSize}" data-color="${singleColor}" ${stock === 0 ? 'disabled' : ''}>åŠ å…¥è³¼ç‰©è»Š</button>
                        </div>
                    `;
                }


                const cardContentHtml = `
                    ${imagesHtml}
                    <div class="product-info">
                        <h2>${productName}</h2>
                        <p><strong>åˆ†é¡:</strong> ${productData.productInfo['åˆ†é¡'] || 'ç„¡'}</p>
                        <p class="price"><strong>å”®åƒ¹:</strong> ${firstPrice}</p>
                        <p><strong>ç”¢å“å…§å®¹:</strong> ${productData.productInfo['ç”¢å“å…§å®¹èªªæ˜'] || 'ç„¡'}</p>
                        ${specSelectorHtml}
                    </div>
                `;

                card.innerHTML = cardContentHtml;
                productListDiv.appendChild(card);
                
                // --- è¦æ ¼é¸æ“‡é€£å‹•é‚è¼¯ ---
                
                if (hasMultipleSpecs) {
                    // ã€é—œéµä¿®æ­£ã€‘ä½¿ç”¨ safeProductId ç¢ºä¿ querySelector æˆåŠŸ
                    const sizeSelect = card.querySelector(`#size-${safeProductId}`);
                    const colorSelect = card.querySelector(`#color-${safeProductId}`);
                    const qtyInput = card.querySelector(`#qty-${safeProductId}`);
                    const stockInfoDiv = card.querySelector(`#stock-info-${safeProductId}`);
                    const addToCartBtn = card.querySelector('.add-to-cart-btn');

                    const updateStock = () => {
                        // ä¿®æ­£ï¼šé€™è£¡çš„æª¢æŸ¥ç¢ºä¿å³ä½¿ ID ç”Ÿæˆæœ‰å•é¡Œï¼Œæˆ‘å€‘ä¹Ÿä¸æœƒå° null æ“ä½œ
                        if (!sizeSelect || !colorSelect || !qtyInput || !stockInfoDiv || !addToCartBtn) {
                             // console.error(`è¦æ ¼é¸æ“‡å™¨å…ƒç´ ç¼ºå¤± (Multi-Spec): ${productName}`); 
                             return; 
                        }
                        
                        const selectedSize = sizeSelect.value;
                        const selectedColor = colorSelect.value;
                        const stockKey = `${selectedSize}-${selectedColor}`;
                        const maxStock = specs.detailsMap[stockKey] || 0;
                        
                        stockInfoDiv.innerHTML = maxStock > 0 ? `åº«å­˜: ${maxStock}` : `è©²è¦æ ¼ ${selectedSize}/${selectedColor} <span class="out-of-stock">ç¼ºè²¨</span>`;
                        qtyInput.max = maxStock;
                        qtyInput.disabled = maxStock === 0;
                        
                        // ç¢ºä¿æ•¸é‡ä¸è¶…éæ–°åº«å­˜
                        let currentQty = parseInt(qtyInput.value) || 1;
                        if (currentQty > maxStock) currentQty = maxStock > 0 ? maxStock : 1;
                        qtyInput.value = Math.max(1, currentQty); 
                        
                        addToCartBtn.disabled = maxStock === 0;
                        addToCartBtn.dataset.size = selectedSize;
                        addToCartBtn.dataset.color = selectedColor;
                    };
                    
                    if (sizeSelect) sizeSelect.addEventListener('change', updateStock);
                    if (colorSelect) colorSelect.addEventListener('change', updateStock);
                    
                    if (qtyInput) qtyInput.addEventListener('input', () => {
                        // ç¢ºä¿è¼¸å…¥æ•¸é‡ä¸è¶…éåº«å­˜ä¸”è‡³å°‘ç‚º 1
                        const max = parseInt(qtyInput.max);
                        if (parseInt(qtyInput.value) > max) {
                            qtyInput.value = max;
                        }
                        if (parseInt(qtyInput.value) < 1 || isNaN(parseInt(qtyInput.value))) {
                            qtyInput.value = 1;
                        }
                    });

                    // åˆå§‹è¼‰å…¥æ™‚æ›´æ–°åº«å­˜è³‡è¨Š 
                    updateStock();
                    
                    // å¤šè¦æ ¼ç”¢å“çš„æŒ‰éˆ•äº‹ä»¶ç¶å®š
                    if (addToCartBtn) {
                        addToCartBtn.addEventListener('click', (e) => {
                            const btn = e.currentTarget;
                            const name = btn.dataset.productName;
                            const price = btn.dataset.price;
                            let size = btn.dataset.size;
                            let color = btn.dataset.color;
                            let quantity = parseInt(card.querySelector(`#qty-${safeProductId}`)?.value || 0); // ä½¿ç”¨ safeProductId
                            
                            if (quantity > 0) {
                                addToCart(name, size, color, quantity, price);
                            } else {
                                alert('è«‹é¸æ“‡æœ‰æ•ˆçš„æ•¸é‡ï¼');
                            }
                        });
                    }
                }
                
                // --- å–®è¦æ ¼ç”¢å“çš„æŒ‰éˆ•äº‹ä»¶ç¶å®š (ç¢ºä¿æŒ‰éˆ•å­˜åœ¨) ---
                const singleAddToCartBtn = card.querySelector('.add-to-cart-btn');
                // ã€é—œéµä¿®æ­£ã€‘ä½¿ç”¨ safeProductId ç¢ºä¿ querySelector æˆåŠŸ
                const singleQtyInput = card.querySelector(`#qty-${safeProductId}`); 
                
                if (!hasMultipleSpecs && singleAddToCartBtn) {
                    singleAddToCartBtn.addEventListener('click', (e) => {
                        const btn = e.currentTarget;
                        const name = btn.dataset.productName;
                        const price = btn.dataset.price;
                        let size = btn.dataset.size;
                        let color = btn.dataset.color;
                        // å®‰å…¨å–å€¼
                        let quantity = parseInt(singleQtyInput?.value || 0); 
                        
                        if (quantity > 0) {
                            addToCart(name, size, color, quantity, price);
                        } else {
                            alert('è«‹é¸æ“‡æœ‰æ•ˆçš„æ•¸é‡ï¼');
                        }
                    });
                    
                    // å–®è¦æ ¼çš„æ•¸é‡è¼¸å…¥æ¡†é™åˆ¶
                    if (singleQtyInput) {
                        singleQtyInput.addEventListener('input', () => {
                            const max = parseInt(singleQtyInput.max);
                            if (parseInt(singleQtyInput.value) > max) {
                                singleQtyInput.value = max;
                            }
                            if (parseInt(singleQtyInput.value) < 1 || isNaN(parseInt(singleQtyInput.value))) {
                                singleQtyInput.value = 1;
                            }
                        });
                    }
                }

                // --- Lightbox äº‹ä»¶ (ç¢ºä¿ img å­˜åœ¨) ---
                const imagesDiv = card.querySelector('.product-images');
                if (imagesDiv) {
                    const img = imagesDiv.querySelector('img');
                    if (img && photos.length > 0) {
                        // ç”±æ–¼ photosJson å·²ç¶“å®‰å…¨è™•ç†ï¼Œé€™è£¡è¦ç”¨ JSON.parse è®€å–å›ä¾†
                        const photosFromData = JSON.parse(img.getAttribute('data-photos').replace(/&quot;/g, '"'));
                        imagesDiv.addEventListener('click', (e) => {
                            e.stopPropagation();
                            openLightbox(photosFromData);
                        });
                    }
                }
                
                // --- å¤–éƒ¨é€£çµé»æ“Šäº‹ä»¶ (ä¿®æ­£ï¼šåªåœ¨æœ‰é€£çµæ™‚ç¶å®š) ---
                const productLink = productData.productInfo['é€£çµ'];
                if (productLink && productLink.trim() !== '' && card) {
                    const fullLink = productLink.startsWith('http://') || productLink.startsWith('https://') ? productLink : `https://${productLink}`;
                    
                    card.addEventListener('click', (event) => { 
                        // åªæœ‰é»æ“Šå¡ç‰‡å…¶ä»–éƒ¨åˆ†æ‰é–‹å•Ÿé€£çµ
                        if (!event.target.closest('.spec-selector') && !event.target.closest('.product-images')) {
                             window.open(fullLink, '_blank');
                        }
                    });
                }
            }
        }
        
        // --- ç¯©é¸å™¨èˆ‡åˆå§‹åŒ–é‚è¼¯ (ä¸è®Š) ---

        function filterProducts() {
            const searchText = searchBox.value.toLowerCase();
            const filteredProducts = {};
            
            for (const productName in allProductsData) {
                const productData = allProductsData[productName];
                const productCategory = productData.productInfo['åˆ†é¡'] || 'ç„¡';
                
                // ä½¿ç”¨é‚è¼¯æˆ–ï¼Œç¢ºä¿æœå°‹ç¯„åœåŒ…å«ç”¢å“å…§å®¹èªªæ˜
                const matchesCategory = activeCategory === 'all' || productCategory.toLowerCase() === activeCategory;
                const description = productData.productInfo['ç”¢å“å…§å®¹èªªæ˜'] || '';
                const matchesSearch = productName.toLowerCase().includes(searchText) || description.toLowerCase().includes(searchText);

                if (matchesCategory && matchesSearch) {
                    filteredProducts[productName] = productData;
                }
            }
            
            renderProducts(filteredProducts);
        }

        function createFilterTags(categories) {
            filtersDiv.innerHTML = '';
            const allTag = document.createElement('div');
            allTag.className = 'filter-tag active';
            allTag.textContent = 'æ‰€æœ‰ç”¢å“';
            allTag.dataset.category = 'all';
            filtersDiv.appendChild(allTag);

            categories.forEach(category => {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                tag.textContent = category;
                tag.dataset.category = category.toLowerCase();
                filtersDiv.appendChild(tag);
            });
            
            filtersDiv.addEventListener('click', (event) => {
                if (event.target.classList.contains('filter-tag')) {
                    document.querySelectorAll('.filter-tag').forEach(tag => tag.classList.remove('active'));
                    event.target.classList.add('active');
                    activeCategory = event.target.dataset.category;
                    filterProducts();
                }
            });
        }
        
        searchBox.addEventListener('input', filterProducts);

        // --- Lightbox é‚è¼¯ (ä¿®æ­£) ---

        function openLightbox(images, startIndex = 0) {
            lightboxImages = images;
            lightboxContent.innerHTML = '';
            images.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                lightboxContent.appendChild(img);
            });
            currentImageIndex = startIndex;
            showImage(currentImageIndex);
            lightbox.style.display = 'flex';
        }

        function showImage(index) {
            const images = lightboxContent.querySelectorAll('img');
            images.forEach((img, i) => {
                if (i === index) {
                    img.classList.add('active');
                } else {
                    img.classList.remove('active');
                }
            });
        }

        closeBtn.addEventListener('click', () => {
            lightbox.style.display = 'none';
        });

        prevBtn.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex > 0) ? currentImageIndex - 1 : lightboxImages.length - 1;
            showImage(currentImageIndex);
        });

        nextBtn.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex < lightboxImages.length - 1) ? currentImageIndex + 1 : 0;
            showImage(currentImageIndex);
        });


        // --- è³‡æ–™è¼‰å…¥èˆ‡è™•ç†é‚è¼¯ (ä¿®æ­£è³‡æ–™è™•ç†çš„å¥å£¯æ€§) ---

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                productListDiv.innerHTML = '';

                if (!Array.isArray(data) || data.length === 0) {
                    productListDiv.innerHTML = '<p>ç›®å‰æ²’æœ‰ç”¢å“è³‡æ–™ã€‚</p>';
                    return;
                }
                
                const groupedProducts = data.reduce((acc, currentItem) => {
                    // ç¢ºä¿æ‰€æœ‰é—œéµæ¬„ä½éƒ½æœ‰é è¨­å€¼ï¼Œé˜²æ­¢å–å€¼éŒ¯èª¤
                    const productName = currentItem['ç”¢å“åç¨±'] || 'ç„¡æ¨™é¡Œ';
                    // ä¿®æ­£ï¼šåœ¨è³‡æ–™è™•ç†çš„æ—©æœŸéšæ®µï¼Œå°±å°‡å°ºå¯¸å’Œé¡è‰²ç¢ºä¿ç‚ºå­—ä¸²é¡å‹ï¼Œæå‡å¥å£¯æ€§
                    const size = String(currentItem['å°ºå¯¸'] || 'ç„¡');
                    const color = String(currentItem['é¡è‰²'] || 'ç„¡');
                    const quantity = parseInt(currentItem['æ•¸é‡']) || 0;
                    const category = currentItem['åˆ†é¡'] || 'ç„¡åˆ†é¡';
                    const price = currentItem['æˆ‘æ–¹å”®åƒ¹'] || 'NT$ åƒ¹æ ¼å¾…å®š';
                    const detailsKey = `${size}-${color}`;

                    if (!acc[productName]) {
                        acc[productName] = {
                            details: {},
                            productInfo: {
                                'å”®åƒ¹': price,
                                'ç”¢å“å…§å®¹èªªæ˜': currentItem['ç”¢å“å…§å®¹èªªæ˜'] || '',
                                'é€£çµ': null,
                                'ç…§ç‰‡é€£çµ': currentItem['ç…§ç‰‡é€£çµ'] || '',
                                'åˆ†é¡': category
                            }
                        };
                    }
                    
                    // ç¢ºä¿åƒ¹æ ¼æ˜¯æœ€æ–°çš„æˆ–éç©º
                    if (price !== 'NT$ åƒ¹æ ¼å¾…å®š') {
                         acc[productName].productInfo['å”®åƒ¹'] = price;
                    }

                    // è™•ç†é€£çµ
                    if (!acc[productName].productInfo['é€£çµ']) {
                        const linkString = currentItem['é€£çµ'] || '';
                        const matches = linkString.match(/https?:\/\/[^\s]+/g);
                        if (matches && matches.length > 0) {
                            acc[productName].productInfo['é€£çµ'] = matches[0];
                        }
                    }

                    if (!acc[productName].details[detailsKey]) {
                        acc[productName].details[detailsKey] = {
                            'å°ºå¯¸': size,
                            'é¡è‰²': color,
                            'æ•¸é‡': 0
                        };
                    }

                    // ç´¯åŠ æ•¸é‡
                    acc[productName].details[detailsKey]['æ•¸é‡'] += quantity;

                    return acc;
                }, {});
                
                allProductsData = groupedProducts;
                
                // è™•ç†åˆ†é¡æ¨™ç±¤
                const categories = [...new Set(data.map(item => item['åˆ†é¡']).filter(Boolean))].sort();
                createFilterTags(categories);
                
                filterProducts(); // åˆæ¬¡æ¸²æŸ“
                updateCartCount(); // åˆå§‹åŒ–è³¼ç‰©è»Šæ•¸é‡
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                productListDiv.innerHTML = '<p>è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API é€£çµæˆ–ç€è¦½å™¨æ§åˆ¶å°éŒ¯èª¤ã€‚</p>';
            });
    </script>

</body>

</html>
